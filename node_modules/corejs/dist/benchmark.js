/**
 * Модуль тестирования скорости выполнения JavaScript
 * @module benchmark
 */
;(function(factory) {
    var registeredInModuleLoader = false;
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory());
        registeredInModuleLoader = true;
    }

    if (!registeredInModuleLoader) {
        window.core.benchmark = factory();
    }
})(/** @lends module:benchmark */function() {
    /**
     * Настройки
     */
    var _settings = {
        times: 10
    };

    /**
     * Показать результаты измерений
     */
    var _showMeasurements = function () {
        var entries = performance.getEntriesByType('measure'),
            i;
        for (i = 0; i < entries.length; i += 1) {
            console.log(' Duration: ' + entries[i].duration + '\n');
        }
    };

    /**
     * Выполнить код
     * @function
     * @param {function} func - тестируемый код
     * @param {number} times - количество выполнений
     * */
    var _execute = function (func, times) {
        var i;
        times = times || _settings.times;
        for (i = 0; i < times; i += 1) {
            func();
        }
    };

    /**
     * Выполнить тестирование кода
     * @param {function} func - тестируемый код
     * @param {number} times - количество выполнений
     * */
    var run = function (func, times) {
        performance.mark('begin');
        if (typeof func === 'function') {
            _execute(func, times);
        }
        performance.mark('end');
        performance.measure('result', 'begin', 'end');
        _showMeasurements();
        performance.clearMeasures();
    };

    /**
     * Выполнить тестирование ajax-кода
     * @param func
     * @param times
     */
    var runAjax = function(func, times) {
        var counter = 0;

        performance.mark('begin');
        $.ajaxSetup({
            cache: false,
            complete: function() {
                counter++;
                if (counter == times) {
                    performance.mark('end');
                    performance.measure('result', 'begin', 'end');
                    _showMeasurements();
                    performance.clearMeasures();
                }
            }
        });
        if (typeof func === 'function') {
            _execute(func, times);
        }
    };

    return {
        run: run,
        runAjax: runAjax
    }
});
